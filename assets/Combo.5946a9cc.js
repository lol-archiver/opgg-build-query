import{_ as ce,c as r,m as $,r as c,n as g,o as de,q as fe,d as f,e as p,u,j as C,s as S,t as j,g as v,w as pe,v as ye,f as ve,x as H,F as Q,i as X,y as Y,p as me,l as he}from"./index.e20b0a8d.js";import{p as be,s as Se}from"./label.52db475e.js";import we from"./Texter.04200b08.js";const L=s=>(me("data-v-c0daf8c2"),s=s(),he(),s),ge=["checked"],ke=["hide-outline","only"],Ve=["value","placeholder","tabindex","disabled"],_e=L(()=>v("p-tip",null,"\u641C\u7D22",-1)),xe={key:0,selected:""},$e=L(()=>v("p-tip",null,"\u5DF2\u9009",-1)),Ce=["selected","title","onClick"],Ae=L(()=>v("p-tip",null,"\u672A\u9009",-1)),Be=["selected","title","focus-now","onClick"],De={__name:"Combo",props:{modelValue:{type:[String,Number,Boolean,Array,Object],default:""},disable:{type:Boolean,default:!1},text:{type:String,default:""},default:{type:[String,Number,Boolean],default:""},...be,disabling:{type:[String,Boolean],default:!1},readonly:{type:[String,Boolean],default:!1},place:{type:[Number,String],default:""},tab:{type:[Number,String],default:0},align:{type:String,default:null},list:{type:Array,default:()=>[]},filter:{type:[String,Boolean,Function],default:!1},multiSelect:{type:[String,Boolean],default:!1},keyShow:{type:[String,Function,Array],default:"text"},keyValue:{type:String,default:"value"},openSwitch:{type:Boolean,default:!1}},emits:["update:modelValue","update:disable","update:value"],setup(s,{emit:k}){const a=s,V=r(()=>a.multiSelect==="array"?a.multiSelect:$(a.multiSelect)),d=r(()=>$(a.disabling)),Z=r(()=>$(a.readonly)),{label_:A,labelWidth_:O,labelAlign_:ee}=Se(a,d),te=r(()=>({width:O.value,textAlign:ee.value})),m=c(d.value&&a.modelValue===!1?a.default:a.modelValue),i=c(d.value?a.modelValue===!1:a.disable);g(()=>a.disable,e=>{d.value||(i.value=e)}),g(()=>a.modelValue,e=>{d.value?e===!1?i.value=!0:(i.value=!1,m.value=e):m.value=e}),g([m,i],([e,t],[l,o])=>{d.value?(e!=l&&k("update:value",e),t!=o&&k("update:disable",t),k("update:modelValue",t===!0?!1:e)):k("update:modelValue",e)});const B=r(()=>{const e=m.value;return V.value?e instanceof Array?e.filter(t=>t):e?String(e).split(",").map(t=>t.trim()).filter(t=>t):[]:[e]}),D=(e,t)=>t===null||typeof t>"u"||typeof t=="boolean"?e===t:e==t,le=e=>{const t=B.value,l=a.keyValue=="$$"?e:e[a.keyValue];return V.value?!!~t.findIndex(o=>D(o,l)):D(t[0],l)},N=c(""),M=r(()=>typeof a.filter=="function"?a.filter:$(a.filter)),ae=(e,t,l)=>{var y,x,J;const o=(x=(y=N.value)==null?void 0:y.trim())!=null?x:"",n=M.value;return n?typeof n=="function"?n(o,e.data,e,t,l):(J=b(e.data))==null?void 0:J.includes(o):!0},T=r(()=>a.list),F=r(()=>T.value.map(e=>({selected:le(e),data:e}))),W=r(()=>F.value.filter(e=>e.selected)),w=r(()=>F.value.filter(e=>!e.selected).filter((e,t,l)=>ae(e,t,l)).filter(e=>{var t;return!((t=e.data)!=null&&t.hidden)})),b=(e,t=0)=>{var o,n;const l=a.keyShow instanceof Array?a.keyShow[t]:a.keyShow;return typeof l=="function"?(o=l(e))!=null?o:"":(n=e==null?void 0:e[l])!=null?n:""},oe=r(()=>B.value.map(e=>b(T.value.find(t=>D(a.keyValue=="$$"?t:t==null?void 0:t[a.keyValue],e)),1)).join("\u3001")),_=c(null),E=c(null),I=c(null),U=c(""),z=c(""),K=c(!1),ne=()=>{K.value=!0},ue=()=>{K.value=!1},q=c(!1),P=()=>{const e=I.value;document.querySelector(`#tippy-${e.id}`)?e.hide():(U.value="auto",z.value=window.getComputedStyle(_.value).width,e.show(),q.value=!q.value)},R=e=>{var t;e.selected=!0,m.value=a.keyValue=="$$"?e.data:(t=e.data)==null?void 0:t[a.keyValue],I.value.hide()},G=e=>{var t;if(V.value){e.selected=!!e.selected;const l=a.keyValue=="$$"?e.data:(t=e.data)==null?void 0:t[a.keyValue],o=new Set(B.value);o.has(l)?o.delete(l):o.add(l);const n=[...o];V.value=="array"?m.value=n:m.value=n.join(",")}else R(e)};de(()=>{I.value=fe(_.value,{placement:"bottom-start",content:E.value,allowHTML:!0,interactive:!0,animation:"",duration:[0,0],offset:[0,-2],trigger:"manual",maxWidth:"unset",onShow:ne,onHide:ue})});const h=c(0),se=()=>{const e=w.value.length;h.value=(e+(h.value-1)%e)%e,Y(()=>{var t;return(t=document.querySelector("p-option[focus-now]"))==null?void 0:t.scrollIntoView({behavior:"auto",block:"center"})})},ie=()=>{const e=w.value.length;h.value=(e+(h.value+1)%e)%e,Y(()=>{var t;return(t=document.querySelector("p-option[focus-now]"))==null?void 0:t.scrollIntoView({behavior:"auto",block:"center"})})};g(w,()=>h.value=0);const re=()=>{const e=w.value[h.value];e&&R(e)};return g(()=>a.openSwitch,()=>P()),(e,t)=>(f(),p("comp-combo",null,[u(d)?(f(),p("p-disabling",{key:0,checked:e.brop(!i.value),onClick:t[0]||(t[0]=l=>i.value=!i.value)},null,8,ge)):C("",!0),u(A)?(f(),p("p-label",{key:1,style:S(u(te)),onClick:t[1]||(t[1]=l=>u(d)&&(i.value=!i.value))},j(u(A)),5)):C("",!0),v("p-value",{ref_key:"domValue",ref:_,"hide-outline":e.brop(K.value),only:e.brop(!u(d)&&!u(A)),onClick:t[2]||(t[2]=l=>!i.value&&!u(Z)&&P())},[v("input",{ref_key:"domValue",ref:_,value:u(oe),style:S({textAlign:s.align}),placeholder:s.place,tabindex:s.tab,readonly:!0,disabled:i.value},null,12,Ve)],8,ke),v("p-drop",{ref_key:"domDrop",ref:E,tabindex:"0",style:S({width:U.value,minWidth:z.value})},[pe(v("p-filter",null,[_e,ve(we,{modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=l=>N.value=l),filter:"","focus-switch":q.value,onKeypress:H(re,["enter"]),onKeyup:H(se,["up"]),onKeydown:H(ie,["down"])},null,8,["modelValue","focus-switch","onKeypress","onKeyup","onKeydown"])],512),[[ye,u(M)]]),u(W).length?(f(),p("p-options",xe,[$e,(f(!0),p(Q,null,X(u(W),(l,o)=>{var n,y;return f(),p("p-option",{key:`combo-option-${o}`,selected:e.brop(l.selected),title:(y=(n=l.data)==null?void 0:n[a.keyValue])!=null?y:b(l.data),style:S({textAlign:s.align}),onClick:x=>G(l)},j(b(l.data)),13,Ce)}),128))])):C("",!0),v("p-options",null,[Ae,u(F).length?C("",!0):(f(),p("p-option",{key:0,style:S({textAlign:s.align}),disabled:""},"\u65E0\u53EF\u7528\u9009\u9879",4)),(f(!0),p(Q,null,X(u(w),(l,o)=>{var n,y;return f(),p("p-option",{key:`combo-option-${o}`,selected:e.brop(l.selected),title:(y=(n=l.data)==null?void 0:n[a.keyValue])!=null?y:b(l.data),style:S({textAlign:s.align}),"focus-now":e.brop(h.value==o),onClick:x=>G(l)},j(b(l.data)),13,Be)}),128))])],4)]))}},Ke=ce(De,[["__scopeId","data-v-c0daf8c2"]]);export{Ke as default};
